# lambda code

## handler method

### event object

- The event object is required.
- When your Lambda function is invoked in one of the supported languages, one of the parameters provided to your handler function is an event object. 
- The event object differs in structure and contents, depending on which event source created it. 
- The contents of the event parameter include all of the data and metadata your Lambda function needs to drive its logic.
   For example, an event created by Amazon API Gateway will contain details related to the HTTPS request that was made by the API client (for example, path, query string, request body). An event created by Amazon S3 when a new object is created will include details about the bucket and the new object.


### context object


- The context object allows your function code to interact with the Lambda execution environment.
- The contents and structure of the context object vary, based on the language runtime your Lambda function is using. At minimum it contains the elements:
  - AWS RequestID – Used to track specific invocations.
  - Runtime – The amount of time in milliseconds remaining before a function timeout.
  - Logging – Information about which Amazon CloudWatch Logs stream your log statements will be sent.

# aws sam cli
functionalities:
- init : initializes a serverless application
- local : runs your app locally
- validate : validates an aws sam template
- deploy : Deploys an AWS SAM application.
This command comes with a guided interactive mode, which you can enable by specifying the --guided parameter. The interactive mode walks you through the parameters required for deployment, provides default options, and saves these options in a configuration file in your project folder. You can initiate subsequent deployments of your application using the sam deploy command. The required parameters will be retrieved from the AWS SAM CLI configuration file.

Deploying Lambda functions through AWS CloudFormation requires an Amazon S3 bucket for the Lambda deployment package. The SAM CLI creates and manages this Amazon S3 bucket for you.
- build : Builds a serverless application and prepares it for subsequent steps in your workflow. 

The sam build command processes your AWS SAM template file, application code, and any applicable language-specific files and dependencies. This command also copies build artifacts in the format and location expected for subsequent steps in your workflow. 

For additional information, see sam build in the Amazon Serverless Application Model Developer Guide.

# serverless CI/CD pipeline

You can incorporate additional tools to create an automated CI/CD pipeline for your serverless applications that integrate with AWS SAM. 

- CodeBuild – Automate the process of packaging code and running tests before the code is deployed.
- CodeDeploy – Use version management options to ensure safe deployments to production.


# configuring your lambda func

First, you'll review the importance of configuring your memory and timeout values. Then you'll review the billing considerations for memory and timeout values before you examine concurrency and how to optimize for it.

- Memory
- timeout
- concurrency

> for cost analysis
## Lambda power tuning

https://serverlessrepo.aws.amazon.com/applications/arn:aws:serverlessrepo:us-east-1:451282441545:applications~aws-lambda-power-tuning


## Concurrent invocations

As an analogy, you can think of concurrency as the total capacity of a restaurant for serving a certain number of diners at one time. If you have seats in the restaurant for 100 diners, only 100 people can sit at the same time. Anyone who comes while the restaurant is full must wait for a current diner to leave before a seat is available. If you use a reservation system, and a dinner party has called to reserve 20 seats, only 80 of those 100 seats are available for people without a reservation. Lambda functions also have a concurrency limit and a reservation system that can be used to set aside runtime for specific instances.

## reasons for setting concurrency limits
Limit a function’s concurrency to achieve the following:

- Limit costs
- Regulate how long it takes you to process a batch of events
- Match it with a downstream resource that cannot scale as quickly as Lambda

Reserve function concurrency to achieve the following: 

- Ensure that you can handle peak expected volume for a critical function 
- Address invocation errors

## Reduce risk using versions and aliases

- versioning
- publish
- aliases

---------------------------------------------------

# Demo

links for S3

```bash
sam init --name demo-sam-app --runtime nodejs14.x --dependency-manager npm --app-template hello-world


sam deploy --stack-name demo-sam-app --template-file template.yaml --resolve-s3 --capabilities CAPABILITY_IAM

# to view the format of the s3 object put
sam local generate-event s3 put

sam validate
```

## Steps:
0. Run it locally
1. First deploy the without S3
2. Added the S3 block in `template.yaml` also add the console.log of the event so that you can 
look at whether the lambda gets triggered when the object gets put to the bucket
3. after that add dynamo db part in template without the business logic in the `app.js`
4. use the table name from the dashboard and use it in the Table name in `app.js` also use he valid dattypes
string, string and use the example s3 put event to get what all info you want to add to the DB
5. finally deploy the infrastructure
6. Destroy
```bash
sam delete --stack-name demo-sam-app
```

## Reference Links
links for S3
https://github.com/aws/serverless-application-model/blob/develop/docs/policy_templates.rst
https://docs.aws.amazon.com/sdk-for-javascript/v2/developer-guide/dynamodb-example-table-read-write.html
https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-property-function-s3.html
